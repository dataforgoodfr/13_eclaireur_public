# Use the following regex to attribute an official name to a column
import re

FORMAT_PRIORITIES = ["parquet", "xls", "xlsx", "json", "csv", "html", "xml", "zip"]

TOPIC_COLUMNS_NORMALIZATION_REGEX = {
    r"(raison_sociale)": "nomBeneficiaire",
    r"(montant|euros)": "montant",
    r"collectivite": "nomAttribuant",
    r"(sire[nt])": "idBeneficiaire",
    r"nom[_ ].*attribu(ant|taire)": "nomAttribuant",
    r"attribu(ant|taire)[_ ]nom": "nomAttribuant",
    r"nom[_ ].*(beneficiaire|association)": "nomBeneficiaire",
    r"associations?([_ ].*nom)?": "nomBeneficiaire",
    r"id(entification)?[_ ].*attribu(ant|taire)": "idAttribuant",
    r"id(entification)?[_ ].*beneficiaire": "idBeneficiaire",
    r"nature": "nature",
    r"(convention|deliberation|vote).*date.*(convention|deliberation|vote)": "dateConvention",
    r"ann[ez_]e": "dateConvention",
    r"pourcentage": "pourcentageSubvention",
    r"notif(ication)?.*[_ ]ue": "notificationUE",
    r"europeenne": "notificationUE",
    r"(date|periode).*versement": "datesPeriodeVersement",
    r"condition": "conditionsVersement",
    r"(description|objet).*(dossier)?": "objet",
    r"subvention.*accord": "montant",
    r"numero.*dossier": "referenceDecision",
    r"reference.*(deliberation|decision)": "referenceDecision",
    r"\brae\b": "idRAE",
    r"_rae_?": "idRAE",
    r"_?rae_": "idRAE",
}
TOPIC_COLUMNS_NORMALIZATION_REGEX = {
    re.compile(k): v for k, v in TOPIC_COLUMNS_NORMALIZATION_REGEX.items()
}

# TopicAggergator currently failes for a dataset if it has columns
# not in the official list after normalization.
# This is done in order to help treat datasets edge case.
# The following columns have been studied and should not lead to
# normalization failures.
TOPIC_IGNORE_EXTRA_COLUMNS = [
    "",
    "@id",
    "@type_0",
    "acronyme",
    "adresse",
    "aide_region_ctu_ncr_cdm",
    "aide_region_votee_sectorielle",
    "aide_regionale",
    "annee_subv",
    "annee",
    "anneeconvention",
    "association (code)",
    "association_code",
    "attrib_type",
    "avanceversement_0",
    "avanceversement",
    "beneficiaires_liste",
    "code insee",
    "code_commune",
    "code_ins_1",
    "code_insee",
    "code_insee",
    "code_postal",
    "code_tranche",
    "codinvfonc",
    "codnatjurbenefca",
    "coll_type",
    "commune",
    "commune",
    "complement",
    "convention_date",
    "cp",
    "cp",
    "cscollnom",
    "cscollsiret",
    "csmodificationdate",
    "datasetid",
    "date 8",
    "date 9",
    "date de la convention",
    "date de la convention",
    "date_cp",
    "date_de_fin_de_convention",
    "date_debut_conv",
    "datedecision_0",
    "datedecision_tri",
    "datedecision",
    "datePeriodeVersement",
    "delegation",
    "descriptif_projet",
    "detailavantagesnature",
    "direction",
    "domaine",
    "dossier_commune_insee",
    "dossier_commune_libl",
    "dossier_epci_libl",
    "dossier_latitude",
    "dossier_longitude",
    "dpt",
    "estimationavantagesnature",
    "etat_d_avancement",
    "formejuridiquebeneficiaire",
    "geo_point_2d_0",
    "geo_point_2d_1",
    "geo_point_2d",
    "geo_shape_coordinates_0",
    "geo_shape_coordinates_1",
    "geo_shape_type",
    "geometry",
    "id_enreg",
    "identification siret de l'attribuant",
    "inaugurati",
    "intdomaine_id",
    "libelle_commune",
    "libelle_departement",
    "libprestanat",
    "localisationcodeinsee",
    "localisationprojetcommune",
    "maitre_d_ouvrage",
    "mono_site",
    "montantgarantie",
    "montantpret",
    "naf_section_code",
    "nature_0",
    "nb adherents isseens",
    "nb adherents totaux",
    "nb_adherents_isseens",
    "nb_adherents_isseens",
    "nb_adherents_totaux",
    "nb_de_dalles_cc44",
    "nb_de_dalles_lambert_93",
    "ndegdeliberation",
    "nom_epci",
    "nom_projet",
    "nombre de demandes d'urbanisme",
    "nombreversements",
    "objectid",
    "objectif_id",
    "objet_1",
    "objet_2",
    "point_geo",
    "population",
    "programme_axe",
    "programme_code",
    "programme_libl",
    "record_timestamp",
    "record_timestamp",
    "recordid",
    "referenceconvention",
    "reponse administrative associee",
    "secteur",
    "secteurs d'activités définies par l'association",
    "siege",
    "siegeterritoire",
    "site_perip",
    "sites_asso",
    "sites_prin",
    "sites_principaux_des_maisons_de_sante_financees",
    "sites",
    "sous_domaine",
    "sous_secteur",
    "sous_theme",
    "sub_date_debut",
    "sub_date_fin",
    "sub_dispositif",
    "superieur_23000eur",
    "taille_archive_zip_cc44",
    "taille_archive_zip_l93",
    "taille_go_cc44",
    "taille_go_l93",
    "termeconvention",
    "thematiques",
    "theme",
    "tiers_categorie",
    "tiers_commune_insee",
    "tiers_commune_libl",
    "total accorde",
    "type_d_association",
    "typetiers",
    "unknown",
    "url_de_telechargement_de_larchive_lambert",
    "url_telechargement_archive_commune_cc44",
]

_topic_ignore_extra_columns_regex = [
    r"subvention_par_adherent_isseen_\d+",
    r"public_cible_\d+",
    r".*\bprojet\b.*",
    r".*point_geo.*",
    r"secteurs_d_activites_definies.*",
    r"lieu_execution.*",
    r"^geo_.*",
    r"@type",
]
TOPIC_IGNORE_EXTRA_REGEX = [re.compile(k) for k in _topic_ignore_extra_columns_regex]
